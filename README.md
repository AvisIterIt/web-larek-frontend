# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Документация приложения

## Общая архитектура

1. **Данные (Data)**: Включают в себя классы для работы с продуктами, заказами, API, и состоянием приложения.
2. **Компоненты представления (View Components)**: Содержат элементы интерфейса, такие как карточки, корзина, формы, модальные окна.
3. **Управление событиями**: Реализовано с помощью `EventEmitter` для подписки и обработки различных событий в приложении.

## Назначение частей

1. **Data**: Классы данных управляют информацией о продуктах и состоянии приложения, обеспечивают получение данных с сервера, их хранение и управление ими.
2. **View Components**: Обеспечивают отображение данных и взаимодействие с пользователем.
3. **EventEmitter**: Отвечает за управление событиями, обеспечивая возможность добавления подписчиков на события и их вызов.

## Взаимодействие частей

Компоненты представления отображают данные, которые предоставляются классами данных. `AppState` управляет состоянием приложения, а `EventEmitter` используется для обработки событий, позволяя обновлять представление на основе действий пользователя или изменений данных. API-класс (`Api`) используется для получения и отправки данных на сервер

---

## Данные, используемые в приложении

1. **Product**: Представляет информацию о продукте, такую как `id`, `description`, `image`, `title`, `category` и `price`.
2. **Order**: Информация о заказе, включающая `address`, `phone`, `email`.
3. **FormErrors**: Ошибки формы, используемые для валидации данных.
4. **OrderResult**: Результат выполнения заказа, возвращаемый сервером.

---

## Компоненты приложения

### Базовый код

#### 1. Класс `Api`

Класс для отправки HTTP-запросов. Используется для общения с сервером.

**Конструктор**

```
constructor(baseUrl: string, options: RequestInit = {})
```

**Аргументы**

- **baseUrl**: `string` — базовый URL для всех запросов.
- **options**: `RequestInit` (опционально) — глобальные опции для всех запросов, например, заголовки.

**Методы**

- `handleResponse(response: Response): Promise<object>` — Обрабатывает ответ от сервера, преобразуя его в JSON.
- `get(url: string): Promise<object>` — Выполняет GET-запрос по указанному URL.
- `post(url: string, data: object, method: string): void` — Выполняет запрос с передачей данных по указанному методу (например, POST или PUT).

#### 2. Класс `LarekApi`

Расширяет `Api` для выполнения специфических задач интернет-магазина, таких как получение списка продуктов и отправка заказа.

**Конструктор**

```
constructor(cdn: string, baseUrl: string, options?: RequestInit)
```

**Аргументы**

- **cdn**: `string` — URL для контента.
- **baseUrl**: `string` — базовый URL для API.
- **options**: `RequestInit` (опционально) — глобальные опции для всех запросов.

**Методы**

- `getProductList(): Promise<Product[]>` — Получает список продуктов из API.
- `orderProducts(order: Order): Promise<OrderResult>` — Отправляет заказ на сервер и возвращает результат выполнения.

#### 3. Класс `AppState`

Управляет состоянием приложения, включая список продуктов, корзину, данные формы заказа, ошибки формы.

**Конструктор**

```
constructor()
```

- Конструктор не принимает параметров. Инициализирует состояние, такое как список продуктов, корзина и данные пользователя.

**Аргументы**

- **catalog**: `Product[]` — список продуктов.
- **basket**: `Product[]` — список товаров в корзине.
- **orderForm**: `{ address: string; phone: string; email: string; }` — данные формы заказа.
- **formErrors**: `FormErrors —` ошибки формы.

**Методы**

- `setCatalog(catalog: Product[]): void` — Устанавливает каталог продуктов.
- `addToBasket(productId: string): void` — Добавляет продукт в корзину по его ID.
- `setOrderField(field: string, value: any): void` — Устанавливает значение для указанного поля формы.
- `getTotal(): number` — Возвращает общую стоимость товаров в корзине.
- `getCatalog(): Product[]` — Возвращает список продуктов.

#### 4. Класс `EventEmitter`

Обеспечивает управление событиями, такими как подписка и триггеринг.

**Конструктор**

```
constructor()
```

- Конструктор инициализирует `events`, хранящий все события и подписчиков.

**Аргументы**

- `events: Map<string, Subscriber[]>` — Хранит события и их подписчиков.

**Методы**

- `on(eventName: string, callback: (data: any) => void): void` — Добавляет подписчика для события.
- `off(eventName: string, callback: (data: any) => void): void` — Удаляет подписчика события.
- `trigger(eventName: string, context: any): void` — Вызывает событие с определенным контекстом.

---

### Компоненты представления

#### 1. `Component<T>`

Базовый компонент для всех UI-элементов. Управляет HTML-элементами.

**Конструктор**

```
constructor()
```

- Не принимает параметров. Инициализирует `container`, в котором содержится компонент.

**Аргументы**

- **container**: `HTMLElement` — HTML-элемент, содержащий компонент.

**Методы**

- `toggleClass(element: HTMLElement, className: string, force?: boolean): void` — Добавляет или убирает CSS-класс у элемента.
- `setText(element: HTMLElement, text: string): void` — Устанавливает текст для элемента.
- `render(data: T): HTMLElement` — Создает и возвращает элемент HTML на основе переданных данных.

#### 2. `Card<T>`

Отображает информацию о продукте в виде карточки.

**Аргументы**

- **title**: `HTMLElement` — Элемент для отображения названия продукта.
- **category**: `HTMLElement` — Элемент для отображения категории.
- **price**: `HTMLElement` — Элемент для отображения цены.

**Методы**

- `setTitle(value: string): void` — Устанавливает заголовок.
- `setCategory(value: string): void` — Устанавливает категорию.
- `setPrice(value: string): void` — Устанавливает цену.

#### 3. `Page`

Управляет страницами, отображающими товары и корзину.

**Аргументы**

- **counter**: `HTMLElement` — Счетчик для отображения количества товаров.
- **catalog**: `HTMLElement` — Контейнер для каталога.
- **basket**: `HTMLElement` — Контейнер для корзины.

**Методы**

- `setCounter(value: number): void` — Устанавливает счетчик товаров.
- `setCatalog(items: Product[]): void` — Устанавливает каталог продуктов.
- `setBasket(items: Product[]): void` — Устанавливает содержимое корзины.

#### 4. `Form<T>`

Обеспечивает работу с формами, например, формой заказа.

**Аргументы**

- submit: `HTMLButtonElement` — Кнопка отправки.
- errors: `HTMLElement` — Элемент для отображения ошибок.

**Методы**

- `onInputChange(field: string, value: any): void` — Обрабатывает изменения полей формы.
- `setErrors(value: string): void` — Устанавливает ошибки формы.
- `render(initial: T): void` — Отображает форму с начальными значениями.

#### 5. `Order`

Форма для оформления заказа.

**Аргументы**

- **buttons**: `HTMLButtonElement[]` — Массив кнопок.
- **container**: `HTMLFormElement` — Контейнер формы.

**Методы**

- `setAddress(value: string): void` — Устанавливает адрес.
- `setPayment(name: string): void` — Устанавливает способ оплаты.

#### 6. `Contacts`

Форма для контактной информации.

**Аргументы**

- **container**: `HTMLFormElement` — Контейнер для контактных данных.

**Методы**

- `setPhone(value: string): void` — Устанавливает телефон.
- `setEmail(value: string): void` — Устанавливает email.

---

## Обработка процессов в приложении

Процессы в приложении реализованы через события с помощью `EventEmitter`. Это позволяет вызывать обновления и изменения в компонентах в ответ на действия пользователя или изменения состояния приложения. Данные передаются через методы и свойства классов, обеспечивая потоковое взаимодействие между компонентами.
